<?php

namespace Ezypay\Resource;


use driverInterface;


/**
 * Class Subscription
 * @package Ezypay\Resource
 */
class Subscription extends Resurce implements \resourceInterfaceSubscription , \resourceInterfaceCreate, \resourceInterfaceUpdate
{
    /**
     * @var string defautl object name
     */
    private $objectType = 'Subscription';

    /**
     * Subscription constructor.
     * @param driverInterface $connector
     */
    public function __construct( \driverInterface $connector )
    {
        parent::__construct($connector,$this->objectType);
    }

    /**
     * Retrieves the list of subscription of an existing customer.
     *
     * @link https://demoapi.ezypay.com/help/docs#!/Subscriptions/SubscriptionsApi_GetSubscriptionList
     * @param array $data
     * @return \resultInterfaceList | \resultInterfaceError
     */
    public function findAll(array $data)
    {
        $this->settings(array(
            'url'    => 'subscriptions?'.http_build_query($data),
            'method' => 'GET'
        ));

        return $this->result();
    }

    /**
     * Retrieves the particular subscription details of an existing customer with the given subscriptionId.
     *
     * @link https://demoapi.ezypay.com/help/docs#!/Subscriptions/SubscriptionsApi_GetSubscription
     * @param $id string The ID of the subscription.
     * @return \result | \resultInterfaceError
     */
    public function findById($id)
    {
        $this->settings(array(
            'url'=> 'subscriptions/' . $id,
            'method' => 'GET'
        ));

        return $this->result();
    }

    /**
     * Creates a new subscription for an existing customer.
     *
     * @link https://demoapi.ezypay.com/help/docs#!/Subscriptions/SubscriptionsApi_CreateSubscription
     * @param array $data The Subscription data. Refer to Request Body Schema (see link).
     * @return \result | \resultInterfaceError
     */
    public function create(array $data)
    {
        $this->settings(array(
            'url' => 'subscriptions',
            'method' => 'POST',
            'data'=> $data
        ));

        return $this->result();
    }

    /**
     * Preview a subscription.
     *
     * @link https://demoapi.ezypay.com/help/docs#!/Subscriptions/SubscriptionsApi_PreviewSubscription
     * @param array $data The Subscription data. Refer to Request Body Schema (see link).
     * @return \result | \resultInterfaceError
     */
    public function preview(array $data)
    {
        $this->settings(array(
            'url' => 'subscriptions/preview',
            'method' => 'POST',
            'data'=> $data
        ));
        $this->setObjectType('SubscriptionPreview');
        $res =$this->result();
        $this->setObjectType($this->objectType);
        return $res;
    }

    /**
     * You can cancel a customer's subscription and remove all future billing related to the subscription. However, all payment that was failed previously would not be removed and to be resolved separately.
     *
     * @link https://demoapi.ezypay.com/help/docs#!/Subscriptions/SubscriptionsApi_CancelSubscription
     * @param $id The ID of the subscription.
     * @return \result | \resultInterfaceError
     */
    public function cancel($id)
    {
        $this->settings(array(
            'url' => 'subscriptions/' . $id . '/cancel',
            'method' => 'PUT'
        ));

        return $this->result();
    }

    /**
     * You can change a subscription payment method already on your payment account. It will turn subscription status to active if inactive status is found.
     *
     * @link https://demoapi.ezypay.com/help/docs#!/Subscriptions/SubscriptionsApi_UpdateSubscriptionPaymentMethod
     * @param $id string subscription ID
     * @param array $data
     * @return \result | \resultInterfaceError
     */
    public function update($id, array $data)
    {
        $this->settings(array(
            'url'=> 'subscriptions/' .$id . '/paymentmethod/' . $data['paymentmethodId'],
            'method' => 'PUT'
        ));
        $this->setObjectType('PaymentMethod');
        $res = $this->result();
        $this->setObjectType($this->objectType);
        return $res;
    }


}
